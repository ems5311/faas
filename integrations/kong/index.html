



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="OpenFaaS is a serverless framework for Docker & Kubernetes">
      
      
        <link rel="canonical" href="https://www.openfaas.com/integrations/kong/">
      
      
        <meta name="author" content="OpenFaaS Authors">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.1">
    
    
      
        <title>Kong - OpenFaaS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.41c6761c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.openfaas.com/" title="OpenFaaS" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OpenFaaS
              </span>
              <span class="md-header-nav__topic">
                Kong
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/openfaas/faas" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      openfaas/faas
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/logo.svg" width="24" height="24">
      
    </span>
    OpenFaaS
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/openfaas/faas" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      openfaas/faas
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/deploy/" title="Part 1 - Deploy" class="md-nav__link">
      Part 1 - Deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/testdrive/" title="Part 2 - OpenFaaS CLI" class="md-nav__link">
      Part 2 - OpenFaaS CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/sample_functions/" title="Part 3 - Sample Functions" class="md-nav__link">
      Part 3 - Sample Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/testdrive/" title="Part 4 - Create a Function" class="md-nav__link">
      Part 4 - Create a Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/testdrive/" title="Part 4 - Create a Function" class="md-nav__link">
      Part 4 - Create a Function
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Deployment Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Deployment Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/swarm/" title="Docker Swarm" class="md-nav__link">
      Docker Swarm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/play-with-docker/" title="Play-with-Docker" class="md-nav__link">
      Play-with-Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Integration Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Integration Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Kong
      </label>
    
    <a href="./" title="Kong" class="md-nav__link md-nav__link--active">
      Kong
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-openfaas" title="Setup OpenFaaS" class="md-nav__link">
    Setup OpenFaaS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-kong" title="Setup Kong" class="md-nav__link">
    Setup Kong
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-kong-to-secure-openfaas" title="Use Kong to secure OpenFaaS" class="md-nav__link">
    Use Kong to secure OpenFaaS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#require-basic-authentication" title="Require basic authentication" class="md-nav__link">
    Require basic authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ssl" title="Add SSL" class="md-nav__link">
    Add SSL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-your-firewall" title="Configure your firewall" class="md-nav__link">
    Configure your firewall
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../traefik/" title="Traefik" class="md-nav__link">
      Traefik
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/gateway/" title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/dashboard/" title="Dashboard UI" class="md-nav__link">
      Dashboard UI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/watchdog/" title="Watchdog" class="md-nav__link">
      Watchdog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/asynchronous/" title="Asynchronous Functions" class="md-nav__link">
      Asynchronous Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/swagger/" title="Swagger API" class="md-nav__link">
      Swagger API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/debug/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developer/chaining_functions/" title="Function Chaining" class="md-nav__link">
      Function Chaining
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-openfaas" title="Setup OpenFaaS" class="md-nav__link">
    Setup OpenFaaS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-kong" title="Setup Kong" class="md-nav__link">
    Setup Kong
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-kong-to-secure-openfaas" title="Use Kong to secure OpenFaaS" class="md-nav__link">
    Use Kong to secure OpenFaaS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#require-basic-authentication" title="Require basic authentication" class="md-nav__link">
    Require basic authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ssl" title="Add SSL" class="md-nav__link">
    Add SSL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-your-firewall" title="Configure your firewall" class="md-nav__link">
    Configure your firewall
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="integrate-kong-with-your-openfaas-cluster">Integrate Kong with your OpenFaaS cluster<a class="headerlink" href="#integrate-kong-with-your-openfaas-cluster" title="Permanent link">&para;</a></h1>
<p><a href="https://getkong.org">Kong</a> is an API gateway that provides features such as security, logging, and rate limiting. By putting this in front of OpenFaaS you can quickly get access to these things and a lot more via <a href="https://getkong.org/plugins/">the many other plugins written</a> for it.</p>
<p>Below is a demo of how you could use Kong as an authentication layer for OpenFaaS.</p>
<h2 id="setup-openfaas">Setup OpenFaaS<a class="headerlink" href="#setup-openfaas" title="Permanent link">&para;</a></h2>
<p>If you haven't already setup OpenFaaS then you can follow one of the deployment guides available here:</p>
<ul>
<li><a href="https://github.com/openfaas/faas/blob/master/guide/deployment_swarm.md">Docker Swarm</a></li>
<li><a href="https://github.com/openfaas/faas/blob/master/guide/deployment_k8s.md">Kubernetes</a></li>
</ul>
<p>Here is a quick reference for Docker Swarm:</p>
<div class="codehilite"><pre><span></span>$ docker swarm init --advertise-addr $(hostname -i)

$ git clone https://github.com/openfaas/faas &amp;&amp; \
  cd faas &amp;&amp; \
  ./deploy_stack.sh
</pre></div>

<p>Check that one of the sample functions works</p>
<div class="codehilite"><pre><span></span>$ curl localhost:8080/function/func_echoit -d &#39;hello world&#39;
hello world
</pre></div>

<h2 id="setup-kong">Setup Kong<a class="headerlink" href="#setup-kong" title="Permanent link">&para;</a></h2>
<p>Kong stores its configuration in Postgres, so we'll create a Postgres and Kong service then run a one-off migration too.</p>
<p>Deploy Postgres and optionally set the <code>POSTGRES_PASSWORD</code></p>
<div class="codehilite"><pre><span></span>$ docker service create --name kong-database \
    --network func_functions --detach=false \
    --constraint &#39;node.role == manager&#39; \
    -e &quot;POSTGRES_USER=kong&quot; \
    -e &quot;POSTGRES_DB=kong&quot; \
    -e &quot;POSTGRES_PASSWORD=secretpassword&quot; \
    postgres:9.4
</pre></div>

<p>Now we will use the Kong image to populate default configuration in the Postgres database:</p>
<div class="codehilite"><pre><span></span>$ docker service create --name=kong-migrations \
    --network func_functions --detach=false --restart-condition=none \
    -e &quot;KONG_DATABASE=postgres&quot; \
    -e &quot;KONG_PG_HOST=kong-database&quot; \
    -e &quot;KONG_PG_PASSWORD=secretpassword&quot; \
    kong:latest kong migrations up
</pre></div>

<p>The last service is Kong itself:</p>
<div class="codehilite"><pre><span></span>$ docker service create --name kong \
    --network func_functions --detach=false \
    --constraint &#39;node.role == manager&#39; \
    -e &quot;KONG_DATABASE=postgres&quot; \
    -e &quot;KONG_PG_HOST=kong-database&quot; \
    -e &quot;KONG_PG_PASSWORD=secretpassword&quot; \
    -e &quot;KONG_PROXY_ACCESS_LOG=/dev/stdout&quot; \
    -e &quot;KONG_ADMIN_ACCESS_LOG=/dev/stdout&quot; \
    -e &quot;KONG_PROXY_ERROR_LOG=/dev/stderr&quot; \
    -e &quot;KONG_ADMIN_ERROR_LOG=/dev/stderr&quot; \
    -p 8000:8000 \
    -p 8443:8443 \
    kong:latest
</pre></div>

<p><strong>Doing things the right way</strong></p>
<p>Kong has an admin port with you can expose by adding <code>-p 8001:8001</code>. In this guide we will hide the port from the off-set so that if you do not have a firewall configured yet, there is less risk of someone gaining access.</p>
<p>Create a <code>curl</code> command alias so we can talk to the Kong admin without exposing its ports to the network.</p>
<p><div class="codehilite"><pre><span></span>$ alias kong_admin_curl=&#39;docker exec $(docker ps -q -f name=&quot;kong\.&quot;) curl&#39;
</pre></div>
See that Kong admin is up and running
<div class="codehilite"><pre><span></span>$ kong_admin_curl -i localhost:8001
HTTP/1.1 200
...
</pre></div></p>
<h2 id="use-kong-to-secure-openfaas">Use Kong to secure OpenFaaS<a class="headerlink" href="#use-kong-to-secure-openfaas" title="Permanent link">&para;</a></h2>
<p>Proxy OpenFaaS's functions through Kong
<div class="codehilite"><pre><span></span>$ kong_admin_curl -X POST \
    --url http://localhost:8001/apis/ \
    --data &#39;name=function&#39; \
    --data &#39;uris=/function&#39; \
    --data &#39;upstream_url=http://gateway:8080/function&#39;

$ curl localhost:8000/function/func_echoit -d &#39;hello world&#39;
hello world
</pre></div></p>
<h3 id="require-basic-authentication">Require basic authentication<a class="headerlink" href="#require-basic-authentication" title="Permanent link">&para;</a></h3>
<p>Enable the basic-auth plugin in Kong</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -X POST http://localhost:8001/plugins \
    --data &quot;name=basic-auth&quot; \
    --data &quot;config.hide_credentials=true&quot;
</pre></div>

<p>Create a consumer with credentials</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -d &quot;username=aladdin&quot; http://localhost:8001/consumers/

$ kong_admin_curl -X POST http://localhost:8001/consumers/aladdin/basic-auth \
    --data &quot;username=aladdin&quot; \
    --data &quot;password=OpenSesame&quot;
</pre></div>

<p>Verify that authentication works</p>
<div class="codehilite"><pre><span></span>$ curl localhost:8000/function/func_echoit -d &#39;hello world&#39;
{&quot;message&quot;:&quot;Unauthorized&quot;}

$ curl localhost:8000/function/func_echoit -d &#39;hello world&#39; \
    -H &#39;Authorization: Basic xxxxxx&#39;
{&quot;message&quot;:&quot;Invalid authentication credentials&quot;}

$ echo -n aladdin:OpenSesame | base64
YWxhZGRpbjpPcGVuU2VzYW1l

$ curl localhost:8000/function/func_echoit -d &#39;hello world&#39; \
    -H &#39;Authorization: Basic YWxhZGRpbjpPcGVuU2VzYW1l&#39;
hello world
</pre></div>

<p>Now lets expose the /ui directory so we can securely use the web GUI</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -i -X POST \
    --url http://localhost:8001/apis/ \
    --data &#39;name=ui&#39; \
    --data &#39;uris=/ui&#39; \
    --data &#39;upstream_url=http://gateway:8080/ui&#39;
</pre></div>

<p>Additionally we need to expose /system/functions since the UI makes Ajax requests to it</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -i -X POST \
    --url http://localhost:8001/apis/ \
    --data &#39;name=system-functions&#39; \
    --data &#39;uris=/system/functions&#39; \
    --data &#39;upstream_url=http://gateway:8080/system/functions&#39;
</pre></div>

<p>Verify that the UI is secure</p>
<div class="codehilite"><pre><span></span>$ curl -i localhost:8000/ui/ \
    -H &#39;Authorization: Basic YWxhZGRpbjpPcGVuU2VzYW1l&#39;

HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
...
</pre></div>

<p>Now visit <a href="http://localhost:8000/ui/">http://localhost:8000/ui/</a> in your browser where you will be asked for credentials.</p>
<h3 id="add-ssl">Add SSL<a class="headerlink" href="#add-ssl" title="Permanent link">&para;</a></h3>
<p>Basic authentication does not protect from man in the middle attacks, so lets add SSL to encrypt the communication.</p>
<p>Create a cert. Here in the demo, we are creating selfsigned certs, but in production you should skip this step and use your existing certificates (or get some from Lets Encrypt).
<div class="codehilite"><pre><span></span>$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /tmp/selfsigned.key -out /tmp/selfsigned.pem \
  -subj &quot;/C=US/ST=CA/L=L/O=OrgName/OU=IT Department/CN=example.com&quot;
</pre></div></p>
<p>Add cert to Kong</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -X POST http://localhost:8001/certificates \
    -F &quot;cert=$(cat /tmp/selfsigned.pem)&quot; \
    -F &quot;key=$(cat /tmp/selfsigned.key)&quot; \
    -F &quot;snis=example.com&quot;

HTTP/1.1 201 Created
...
</pre></div>

<p>Put the cert in front OpenFaaS</p>
<div class="codehilite"><pre><span></span>$ kong_admin_curl -i -X POST http://localhost:8001/apis \
    -d &quot;name=ssl-api&quot; \
    -d &quot;upstream_url=http://gateway:8080&quot; \
    -d &quot;hosts=example.com&quot;
HTTP/1.1 201 Created
...
</pre></div>

<p>Verify that the cert is now in use. Note the '-k' parameter is just here to work around the fact that we are using self signed certs.
<div class="codehilite"><pre><span></span>$ curl -k https://localhost:8443/function/func_echoit \
  -d &#39;hello world&#39; -H &#39;Host: example.com &#39;\
  -H &#39;Authorization: Basic YWxhZGRpbjpPcGVuU2VzYW1l&#39;
hello world
</pre></div></p>
<h2 id="configure-your-firewall">Configure your firewall<a class="headerlink" href="#configure-your-firewall" title="Permanent link">&para;</a></h2>
<p>Between OpenFaaS and Kong a lot of ports are exposed on your host machine. Most importantly you should hide port 8080 since that is where OpenFaaS's functions live which you were trying to secure in the first place. In the end it is best to only expose either 8000 or 8443 out of your network depending if you added SSL or not.</p>
<p>Another option concerning port 8000 is to expose both 8000 and 8443 and enable <a href="https://getkong.org/docs/latest/proxy/#the-https_only-property">https_only</a> which is used to notify clients to upgrade to https from http.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../deployment/play-with-docker/" title="Play-with-Docker" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Play-with-Docker
              </span>
            </div>
          </a>
        
        
          <a href="../traefik/" title="Traefik" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Traefik
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 OpenFaaS Project
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://www.openfaas.com/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/openfaas/faas" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/openfaas" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>