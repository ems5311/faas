



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="OpenFaaS is a serverless framework for Docker & Kubernetes">
      
      
        <link rel="canonical" href="https://www.openfaas.com/developer/watchdog/">
      
      
        <meta name="author" content="OpenFaaS Authors">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.1">
    
    
      
        <title>Watchdog - OpenFaaS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.41c6761c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.openfaas.com/" title="OpenFaaS" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OpenFaaS
              </span>
              <span class="md-header-nav__topic">
                Watchdog
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/openfaas/faas" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      openfaas/faas
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/logo.svg" width="24" height="24">
      
    </span>
    OpenFaaS
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/openfaas/faas" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      openfaas/faas
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/deploy/" title="Part 1 - Deploy" class="md-nav__link">
      Part 1 - Deploy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/testdrive/" title="Part 2 - OpenFaaS CLI" class="md-nav__link">
      Part 2 - OpenFaaS CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/sample_functions/" title="Part 3 - Sample Functions" class="md-nav__link">
      Part 3 - Sample Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/testdrive/" title="Part 4 - Create a Function" class="md-nav__link">
      Part 4 - Create a Function
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Deployment Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Deployment Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/swarm/" title="Docker Swarm" class="md-nav__link">
      Docker Swarm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deployment/play-with-docker/" title="Play-with-Docker" class="md-nav__link">
      Play-with-Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Integration Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Integration Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/kong/" title="Kong" class="md-nav__link">
      Kong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/traefik/" title="Traefik" class="md-nav__link">
      Traefik
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gateway/" title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dashboard/" title="Dashboard UI" class="md-nav__link">
      Dashboard UI
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Watchdog
      </label>
    
    <a href="./" title="Watchdog" class="md-nav__link md-nav__link--active">
      Watchdog
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-a-new-function-the-easy-way" title="Create a new function the easy way" class="md-nav__link">
    Create a new function the easy way
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-your-function" title="Package your function" class="md-nav__link">
    Package your function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-a-docker-healthcheck" title="Implementing a Docker Healthcheck" class="md-nav__link">
    Implementing a Docker Healthcheck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environmental-overrides" title="Environmental Overrides:" class="md-nav__link">
    Environmental Overrides:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-tuning" title="Advanced / Tuning" class="md-nav__link">
    Advanced / Tuning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-http-headers" title="Working with HTTP Headers" class="md-nav__link">
    Working with HTTP Headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-methods" title="HTTP Methods" class="md-nav__link">
    HTTP Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-type-of-requestresponse" title="Content-Type of Request/Response" class="md-nav__link">
    Content-Type of Request/Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-dont-want-to-use-the-watchdog" title="I don't want to use the watchdog" class="md-nav__link">
    I don't want to use the watchdog
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuning-auto-scaling" title="Tuning Auto-scaling" class="md-nav__link">
    Tuning Auto-scaling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contribute-to-the-watchdog" title="Contribute to the Watchdog" class="md-nav__link">
    Contribute to the Watchdog
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../asynchronous/" title="Asynchronous Functions" class="md-nav__link">
      Asynchronous Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swagger/" title="Swagger API" class="md-nav__link">
      Swagger API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debug/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../chaining_functions/" title="Function Chaining" class="md-nav__link">
      Function Chaining
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-a-new-function-the-easy-way" title="Create a new function the easy way" class="md-nav__link">
    Create a new function the easy way
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-your-function" title="Package your function" class="md-nav__link">
    Package your function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-a-docker-healthcheck" title="Implementing a Docker Healthcheck" class="md-nav__link">
    Implementing a Docker Healthcheck
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environmental-overrides" title="Environmental Overrides:" class="md-nav__link">
    Environmental Overrides:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-tuning" title="Advanced / Tuning" class="md-nav__link">
    Advanced / Tuning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-http-headers" title="Working with HTTP Headers" class="md-nav__link">
    Working with HTTP Headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-methods" title="HTTP Methods" class="md-nav__link">
    HTTP Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-type-of-requestresponse" title="Content-Type of Request/Response" class="md-nav__link">
    Content-Type of Request/Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#i-dont-want-to-use-the-watchdog" title="I don't want to use the watchdog" class="md-nav__link">
    I don't want to use the watchdog
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuning-auto-scaling" title="Tuning Auto-scaling" class="md-nav__link">
    Tuning Auto-scaling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contribute-to-the-watchdog" title="Contribute to the Watchdog" class="md-nav__link">
    Contribute to the Watchdog
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="watchdog">Watchdog<a class="headerlink" href="#watchdog" title="Permanent link">&para;</a></h1>
<p>The watchdog provides an unmanaged and generic interface between the outside world and your function. Its job is to marshal a HTTP request accepted on the API Gateway and to invoke your chosen appliaction. The watchdog is a tiny Golang webserver - see the diagram below for how this process works.</p>
<p><img alt="" src="https://pbs.twimg.com/media/DGScDblUIAAo4H-.jpg:large" /></p>
<blockquote>
<p>Above: a tiny web-server or shim that forks your desired process for every incoming HTTP request</p>
</blockquote>
<p>Every function needs to embed this binary and use it as its <code>ENTRYPOINT</code> or <code>CMD</code>, in effect it is the init process for your container. Once your process is forked the watchdog passses in the HTTP request via <code>stdin</code> and reads a HTTP response via <code>stdout</code>. This means your process does not need to know anything about the web or HTTP.</p>
<h2 id="create-a-new-function-the-easy-way">Create a new function the easy way<a class="headerlink" href="#create-a-new-function-the-easy-way" title="Permanent link">&para;</a></h2>
<p><strong>Create a function via the CLI</strong></p>
<p>The easiest way to create a function is to use a template and the FaaS CLI. The CLI allows you to abstract all Docker knowledge away, you just have to write a handler file in one of the supported programming languages.</p>
<ul>
<li>
<p><a href="https://blog.alexellis.io/first-faas-python-function/">Your first serverless Python function with OpenFaaS</a></p>
</li>
<li>
<p><a href="https://github.com/openfaas/faas-cli">Read a tutorial on the FaaS CLI</a></p>
</li>
</ul>
<h2 id="package-your-function">Package your function<a class="headerlink" href="#package-your-function" title="Permanent link">&para;</a></h2>
<p>Here's how to package your function if you don't want to use the CLI or have existing binaries or images:</p>
<ul>
<li>Use an existing or a new Docker image as base image <code>FROM</code></li>
<li>Add the fwatchdog binary from the <a href="https://github.com/openfaas/faas/releases">Releases page</a> via <code>curl</code> or <code>ADD https://</code></li>
<li>Set an <code>fprocess</code> environmental variable with the function you want to run for each request</li>
<li>Expose port <code>8080</code></li>
<li>Set the <code>CMD</code> to <code>fwatchdog</code></li>
</ul>
<p>Example Dockerfile for an <code>echo</code> function:</p>
<div class="codehilite"><pre><span></span>FROM alpine:3.5

ADD https://github.com/openfaas/faas/releases/download/v0.5-alpha/fwatchdog /usr/bin
RUN chmod +x /usr/bin/fwatchdog

# Define your UNIX binary here
ENV fprocess=&quot;/bin/cat&quot;

CMD [&quot;fwatchdog&quot;]
</pre></div>

<h2 id="implementing-a-docker-healthcheck">Implementing a Docker Healthcheck<a class="headerlink" href="#implementing-a-docker-healthcheck" title="Permanent link">&para;</a></h2>
<p>A Docker Healthcheck is not required but is best practice. It will make sure that the watchdog is ready to accept a request before forwarding requests via the API Gateway. If the function or watchdog runs into an unrecoverable issue Swarm will also be able to restart the container.</p>
<p>Here is an example of the <code>echo</code> function implementing a healthcheck with a 5-second checking interval.</p>
<div class="codehilite"><pre><span></span>FROM functions/alpine

ENV fprocess=&quot;cat /etc/hostname&quot;

HEALTHCHECK --interval=5s CMD [ -e /tmp/.lock ] || exit 1
</pre></div>

<p>The watchdog process creates a .lock file in <code>/tmp/</code> on starting its internal Golang HTTP server. <code>[ -e file_name ]</code> is shell to check if a file exists. With Windows Containers this is an invalid path so you may want to set the <code>suppress_lock</code> environmental variable.</p>
<p>Read my Docker Swarm tutorial on Healthchecks:</p>
<ul>
<li><a href="http://blog.alexellis.io/test-drive-healthcheck/">Test-drive Docker Healthcheck in 10 minutes</a></li>
</ul>
<h2 id="environmental-overrides">Environmental Overrides:<a class="headerlink" href="#environmental-overrides" title="Permanent link">&para;</a></h2>
<p>The watchdog can be configured through environmental variables. You must always specifiy an <code>fprocess</code> variable.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fprocess</code></td>
<td>The process to invoke for each function call. This must be a UNIX binary and accept input via STDIN and output via STDOUT.</td>
</tr>
<tr>
<td><code>cgi_headers</code></td>
<td>HTTP headers from request are made available through environmental variables - <code>Http_X_Served_By</code> etc. See section: <em>Handling headers</em> for more detail. Enabled by default.</td>
</tr>
<tr>
<td><code>marshal_requests</code></td>
<td>Instead of re-directing the raw HTTP body into your fprocess, it will first be marshalled into JSON. Use this if you need to work with HTTP headers and do not want to use environmental variables via the <code>cgi_headers</code> flag.</td>
</tr>
<tr>
<td><code>content_type</code></td>
<td>Force a specific Content-Type response for all responses.</td>
</tr>
<tr>
<td><code>write_timeout</code></td>
<td>HTTP timeout for writing a response body from your function (in seconds)</td>
</tr>
<tr>
<td><code>read_timeout</code></td>
<td>HTTP timeout for reading the payload from the client caller (in seconds)</td>
</tr>
<tr>
<td><code>suppress_lock</code></td>
<td>The watchdog will attempt to write a lockfile to /tmp/ for swarm healthchecks - set this to true to disable behaviour.</td>
</tr>
<tr>
<td><code>exec_timeout</code></td>
<td>Hard timeout for process exec'd for each incoming request (in seconds). Disabled if set to 0.</td>
</tr>
<tr>
<td><code>write_debug</code></td>
<td>Write all output, error messages, and additional information to the logs. Default is false.</td>
</tr>
</tbody>
</table>
<h2 id="advanced-tuning">Advanced / Tuning<a class="headerlink" href="#advanced-tuning" title="Permanent link">&para;</a></h2>
<h3 id="working-with-http-headers">Working with HTTP Headers<a class="headerlink" href="#working-with-http-headers" title="Permanent link">&para;</a></h3>
<p>Headers and other request information are injected into environmental variables in the following format:</p>
<p>The <code>X-Forwarded-By</code> header becomes available as <code>Http_X_Forwarded_By</code></p>
<ul>
<li><code>Http_Method</code> - GET/POST etc</li>
<li><code>Http_Query</code> - QueryString value</li>
<li><code>Http_ContentLength</code> - gives the total content-length of the incoming HTTP request received by the watchdog.</li>
</ul>
<blockquote>
<p>This behaviour is enabled by the <code>cgi_headers</code> environmental variable which is enabled by default.</p>
</blockquote>
<p>Here's an example of a POST request with an additional header and a query-string.</p>
<div class="codehilite"><pre><span></span>$ cgi_headers=true fprocess=env ./watchdog &amp;
2017/06/23 17:02:58 Writing lock-file to: /tmp/.lock

$ curl -X POST &quot;localhost:8080?q=serverless&amp;page=1&quot; \
    -H X-Forwarded-By:http://my.vpn.com
</pre></div>

<p>This is what you'd see if you had set your <code>fprocess</code> to <code>env</code> on a Linux system:</p>
<div class="codehilite"><pre><span></span>Http_User_Agent=curl/7.43.0
Http_Accept=*/*
Http_X_Forwarded_By=http://my.vpn.com
Http_Method=POST
Http_Query=q=serverless&amp;page=1
</pre></div>

<p>You can also use the <code>GET</code> verb:</p>
<div class="codehilite"><pre><span></span>$ curl &quot;localhost:8080?action=quote&amp;qty=1&amp;productId=105&quot;
</pre></div>

<p>The output from the watchdog would be:</p>
<div class="codehilite"><pre><span></span>Http_User_Agent=curl/7.43.0
Http_Accept=*/*
Http_Method=GET
Http_Query=action=quote&amp;qty=1&amp;productId=105
</pre></div>

<p>You can now use HTTP state from within your application to make decisions.</p>
<h3 id="http-methods">HTTP Methods<a class="headerlink" href="#http-methods" title="Permanent link">&para;</a></h3>
<p>The HTTP methods supported for the watchdog are:</p>
<p>With a body:
* <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>UPDATE</code></p>
<p>Without a body:
* <code>GET</code></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The API Gateway currently supports the POST route for functions.</p>
</div>
<h3 id="content-type-of-requestresponse">Content-Type of Request/Response<a class="headerlink" href="#content-type-of-requestresponse" title="Permanent link">&para;</a></h3>
<p>By default the watchdog will match the response of your function to the "Content-Type" of the client.</p>
<ul>
<li>If your client sends a JSON post with a Content-Type of <code>application/json</code> this will be matched automatically in the response.</li>
<li>If your client sends a JSON post with a Content-Type of <code>text/plain</code> this will be matched automatically in the response too</li>
</ul>
<p>To override the Content-Type of all your responses set the <code>content_type</code> environmental variable.</p>
<h3 id="i-dont-want-to-use-the-watchdog">I don't want to use the watchdog<a class="headerlink" href="#i-dont-want-to-use-the-watchdog" title="Permanent link">&para;</a></h3>
<p>This is an unsupported use-case for the OpenFaaS project however if your container exposes HTTP POST on port <code>8080</code> then the OpenFaaS API gateway and other tooling will manage your container.</p>
<h3 id="tuning-auto-scaling">Tuning Auto-scaling<a class="headerlink" href="#tuning-auto-scaling" title="Permanent link">&para;</a></h3>
<p>Auto-scaling starts at 1 replica and steps up in blocks of 5:</p>
<ul>
<li>1-&gt;5</li>
<li>5-&gt;10</li>
<li>10-&gt;15</li>
<li>15-&gt;20</li>
</ul>
<p>You can override the upper limit of auto-scaling by setting the following label on your container:</p>
<div class="codehilite"><pre><span></span>com.faas.max_replicas: &quot;10&quot;
</pre></div>

<p>If you want to disable scaling, set the <code>com.faas.max_replicas</code> value to <code>&quot;1&quot;</code>.</p>
<h2 id="contribute-to-the-watchdog">Contribute to the Watchdog<a class="headerlink" href="#contribute-to-the-watchdog" title="Permanent link">&para;</a></h2>
<p>To contribute to the OpenFaaS Watchdog component checkout the "./build.sh" scripts and acompanying Dockerfiles.</p>
<ul>
<li><a href="https://github.com/openfaas/faas/blob/master/ROADMAP.md">Roadmap and Contributing</a></li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../dashboard/" title="Dashboard UI" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Dashboard UI
              </span>
            </div>
          </a>
        
        
          <a href="../functions/" title="Functions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Functions
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 OpenFaaS Project
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://www.openfaas.com/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/openfaas/faas" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/openfaas" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>